import matplotlib.pyplot as plt
import numpy as np

def visualize_loss(task2losses, title):
    """绘制不同任务的loss曲线"""
    fig, axes = plt.subplots(2, 5, figsize=(20, 8))
    axes = axes.flatten()
    for i, (task, losses) in enumerate(task2losses.items()):
        epochs = list(range(0, 3001, 100))
        ax = axes[i]
        ax.plot(epochs, losses, 'b-', linewidth=2)
        ax.set_title(f'{task}', fontsize=12, fontweight='bold')
        ax.set_xlabel('Epoch')
        ax.set_ylabel('Loss')
        ax.grid(True, alpha=0.3)
        ax.set_xlim(0, 3100)
        ax.set_ylim(min(losses) - 1, max(losses) + 1)
    plt.suptitle(f'Loss Curves for 10 Tasks ({title})', fontsize=16, fontweight='bold')
    plt.tight_layout()
    plt.show()

def visualize_f1_matrix(task2f1, title):
    """绘制F1分数矩阵热图"""
    tasks = list(task2f1.keys())
    f1_matrix = np.array([task2f1[task] for task in tasks])
    fig, ax = plt.subplots(figsize=(12, 8))
    im = ax.imshow(f1_matrix, cmap='RdYlGn', vmin=0, vmax=1, aspect='auto')
    cbar = ax.figure.colorbar(im, ax=ax)
    cbar.ax.set_ylabel('F1 Score', rotation=-90, va="bottom")
    ax.set_xticks(np.arange(len(tasks)))
    ax.set_yticks(np.arange(len(tasks)))
    ax.set_xticklabels([f'Task {i+1}' for i in range(len(tasks))], rotation=45, ha='right')
    ax.set_yticklabels(tasks)
    for i in range(len(tasks)):
        for j in range(len(tasks)):
            text = ax.text(j, i, f'{f1_matrix[i, j]:.2f}',
                          ha="center", va="center", 
                          color="white" if f1_matrix[i, j] < 0.5 else "black",
                          fontsize=8)
    ax.set_title(f'F1 Scores After Each Task ({title})\nRows: Test Tasks, Columns: Training Stage', fontsize=14, fontweight='bold', pad=20)
    plt.tight_layout()
    plt.show()

def visualize_f1_line(task2f1, title):
    """绘制F1分数折线图"""
    fig, axes = plt.subplots(2, 5, figsize=(20, 8))
    axes = axes.flatten()
    tasks = list(task2f1.keys())
    for idx, task_name in enumerate(tasks):
        ax = axes[idx]
        stages = list(range(1, 11))
        f1_scores = task2f1[task_name]
        ax.plot(stages, f1_scores, 'o-', linewidth=2, markersize=6, color='tab:blue')
        task_index = idx + 1
        if task_index <= len(f1_scores):
            ax.plot(task_index, f1_scores[task_index-1], 'o', markersize=10, color='red', label='Learning Point')
        ax.set_title(f'{task_name}', fontsize=12, fontweight='bold')
        ax.set_xlabel('Training Stage')
        ax.set_ylabel('F1 Score')
        ax.set_xticks(stages)
        ax.set_ylim(-0.1, 1.1)
        ax.grid(True, alpha=0.3)
        ax.legend()
    plt.suptitle(f'F1 Score Evolution During Training ({title})', fontsize=16, fontweight='bold')
    plt.tight_layout()
    plt.show()

if __name__ == '__main__':
    simple_task2losses = {
        'AntiReach':                    [3.4895, 0.7363, 0.5760, 0.3384, 0.2203, 0.1612, 0.1237, 0.0970, 0.0764, 0.0597, 0.0474, 0.0373, 0.0297, 0.0234, 0.0184, 0.0143, 0.0113, 0.0091, 0.0073, 0.0059, 0.0049, 0.0041, 0.0036, 0.0031, 0.0026, 0.0023, 0.0020, 0.0018, 0.0016, 0.0014, 0.0013],
        'ContextDecisionMaking':        [1.0973, 0.1726, 0.1690, 0.1822, 0.1699, 0.1706, 0.1703, 0.1655, 0.1698, 0.1713, 0.1690, 0.1673, 0.1651, 0.1687, 0.1679, 0.1652, 0.1665, 0.1607, 0.1606, 0.1516, 0.1440, 0.1459, 0.1452, 0.1434, 0.1459, 0.1429, 0.1443, 0.1424, 0.1453, 0.1472, 0.1373],
        'DelayComparison':              [0.4515, 0.0260, 0.0216, 0.0149, 0.0088, 0.0053, 0.0031, 0.0026, 0.0031, 0.0024, 0.0014, 0.0014, 0.0011, 0.0019, 0.0006, 0.0012, 0.0012, 0.0007, 0.0008, 0.0008, 0.0006, 0.0008, 0.0012, 0.0007, 0.0031, 0.0010, 0.0010, 0.0011, 0.0003, 0.0027, 0.0009],
        'DelayMatchCategory':           [1.2265, 0.0462, 0.0435, 0.0426, 0.0423, 0.0419, 0.0421, 0.0412, 0.0417, 0.0419, 0.0424, 0.0417, 0.0463, 0.0429, 0.0425, 0.0418, 0.0419, 0.0421, 0.0419, 0.0427, 0.0418, 0.0424, 0.0414, 0.0418, 0.0418, 0.0421, 0.0417, 0.0415, 0.0419, 0.0419, 0.0428],
        'DelayMatchSample':             [0.6148, 0.0510, 0.0237, 0.0031, 0.0014, 0.0008, 0.0251, 0.0021, 0.0011, 0.0008, 0.0005, 0.0004, 0.0004, 0.0003, 0.0003, 0.0002, 0.0002, 0.0002, 0.0002, 0.0002, 0.0002, 0.0001, 0.0001, 0.0001, 0.0001, 0.0001, 0.0001, 0.0001, 0.0001, 0.0001, 0.0001],
        'DelayMatchSampleDistractor1D': [0.0200, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000],
        'DelayPairedAssociation':       [0.8634, 0.0450, 0.0420, 0.0435, 0.0422, 0.0420, 0.0418, 0.0437, 0.0446, 0.0424, 0.0430, 0.0417, 0.0436, 0.0353, 0.0418, 0.0414, 0.0417, 0.0413, 0.0418, 0.0428, 0.0418, 0.0416, 0.0423, 0.0397, 0.0423, 0.0423, 0.0415, 0.0418, 0.0380, 0.0428, 0.0419],
        'DualDelayMatchSample':         [2.7142, 0.1341, 0.1364, 0.1294, 0.1250, 0.1244, 0.1254, 0.1299, 0.1252, 0.1261, 0.1247, 0.1144, 0.1123, 0.0871, 0.0681, 0.0670, 0.0432, 0.0271, 0.0239, 0.0185, 0.0141, 0.0115, 0.0087, 0.0073, 0.0057, 0.0049, 0.0034, 0.0030, 0.0023, 0.0019, 0.0018],
        'EconomicDecisionMaking':       [0.4728, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000],
        'GoNogo':                       [0.6843, 0.0007, 0.0003, 0.0002, 0.0002, 0.0001, 0.0001, 0.0001, 0.0001, 0.0001, 0.0001, 0.0001, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000]
    }
    simple_task2f1 = {
        'AntiReach':                    [1.0000, 0.0371, 0.0289, 0.0361, 0.0289, 0.0289, 0.0321, 0.0278, 0.0289, 0.0376],
        'ContextDecisionMaking':        [0.0000, 0.3251, 0.3248, 0.3252, 0.3123, 0.3249, 0.3246, 0.3143, 0.3253, 0.3220],
        'DelayComparison':              [0.0000, 0.0000, 0.9856, 0.3283, 0.5013, 0.3283, 0.3283, 0.3040, 0.3283, 0.3283],
        'DelayMatchCategory':           [0.0000, 0.0000, 0.0000, 0.5571, 0.3728, 0.3230, 0.3371, 0.5065, 0.3230, 0.4452],
        'DelayMatchSample':             [0.0000, 0.0000, 0.0000, 0.0000, 1.0000, 0.3212, 0.3212, 0.2888, 0.3212, 0.3504],
        'DelayMatchSampleDistractor1D': [0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 1.0000, 0.4613, 0.2947, 0.4987, 0.4859],
        'DelayPairedAssociation':       [0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.8326, 0.3389, 0.4928, 0.6628],
        'DualDelayMatchSample':         [0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 1.0000, 0.3004, 0.3004],
        'EconomicDecisionMaking':       [0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 1.0000, 0.3429],
        'GoNogo':                       [0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 1.0000]
    }
    SWIL_task2losses = {
        'AntiReach':                    [3.4891, 0.7364, 0.5718, 0.3388, 0.2197, 0.1623, 0.1252, 0.0981, 0.0770, 0.0605, 0.0479, 0.0374, 0.0297, 0.0234, 0.0183, 0.0144, 0.0112, 0.0089, 0.0073, 0.0059, 0.0050, 0.0042, 0.0036, 0.0031, 0.0027, 0.0023, 0.0020, 0.0018, 0.0016, 0.0015, 0.0013],
        'ContextDecisionMaking':        [0.4045, 0.0617, 0.0544, 0.0567, 0.0571, 0.0587, 0.0545, 0.0531, 0.0522, 0.0563, 0.0541, 0.0537, 0.0536, 0.0525, 0.0526, 0.0533, 0.0526, 0.0566, 0.0540, 0.0539, 0.0520, 0.0536, 0.0535, 0.0526, 0.0541, 0.0509, 0.0539, 0.0513, 0.0529, 0.0497, 0.0513],
        'DelayComparison':              [0.1517, 0.0964, 0.0838, 0.0575, 0.0652, 0.0569, 0.0679, 0.0534, 0.0679, 0.0500, 0.0675, 0.0753, 0.0511, 0.0604, 0.0447, 0.0495, 0.0504, 0.0438, 0.0467, 0.0431, 0.0586, 0.0465, 0.0520, 0.0316, 0.0509, 0.0339, 0.0375, 0.0485, 0.0240, 0.0222, 0.0293],
        'DelayMatchCategory':           [0.2933, 0.0449, 0.0233, 0.0362, 0.0401, 0.0370, 0.0247, 0.0276, 0.0367, 0.0256, 0.0334, 0.0335, 0.0246, 0.0215, 0.0373, 0.0236, 0.0198, 0.0207, 0.0323, 0.0215, 0.0193, 0.0228, 0.0197, 0.0358, 0.0181, 0.0211, 0.0209, 0.0176, 0.0277, 0.0226, 0.0204],
        'DelayMatchSample':             [1.2601, 0.0430, 0.0026, 0.0011, 0.0006, 0.0004, 0.0003, 0.0002, 0.0002, 0.0001, 0.0001, 0.0001, 0.0001, 0.0001, 0.0001, 0.0339, 0.0026, 0.0018, 0.0013, 0.0010, 0.0009, 0.0008, 0.0006, 0.0006, 0.0005, 0.0004, 0.0004, 0.0004, 0.0004, 0.0003, 0.0003],
        'DelayMatchSampleDistractor1D': [0.1691, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000],
        'DelayPairedAssociation':       [1.0382, 0.0460, 0.0405, 0.0306, 0.0243, 0.0194, 0.0163, 0.0160, 0.0149, 0.0157, 0.0183, 0.0160, 0.0161, 0.0154, 0.0162, 0.0159, 0.0154, 0.0152, 0.0158, 0.0157, 0.0150, 0.0157, 0.0154, 0.0155, 0.0158, 0.0150, 0.0157, 0.0164, 0.0161, 0.0153, 0.0158],
        'DualDelayMatchSample':         [2.4030, 0.1422, 0.1121, 0.1037, 0.0986, 0.0850, 0.0885, 0.0662, 0.0676, 0.0569, 0.0384, 0.0444, 0.0466, 0.0386, 0.0290, 0.0409, 0.0316, 0.0415, 0.0373, 0.0232, 0.0389, 0.0408, 0.0274, 0.0385, 0.0313, 0.0224, 0.0280, 0.0284, 0.0251, 0.0290, 0.0129],
        'EconomicDecisionMaking':       [0.4455, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000],
        'GoNogo':                       [1.6564, 0.0008, 0.0004, 0.0002, 0.0002, 0.0002, 0.0001, 0.0001, 0.0001, 0.0001, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0003, 0.0002, 0.0001, 0.0001, 0.0001, 0.0001, 0.0001, 0.0001, 0.0001, 0.0001, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000]
    }
    SWIL_task2f1 = {
        'AntiReach':                    [1.0000, 1.0000, 1.0000, 1.0000, 0.0752, 0.0289, 0.0289, 0.0289, 0.0289, 0.0289],
        'ContextDecisionMaking':        [0.0000, 0.3251, 0.4077, 0.3932, 0.3143, 0.3248, 0.3250, 0.3998, 0.3250, 0.3242],
        'DelayComparison':              [0.0000, 0.0000, 0.9930, 1.0000, 0.4795, 0.3283, 0.3283, 0.3139, 0.3283, 0.3283],
        'DelayMatchCategory':           [0.0000, 0.0000, 0.0000, 0.6423, 0.4120, 0.3230, 0.5345, 0.5587, 0.3230, 0.3230],
        'DelayMatchSample':             [0.0000, 0.0000, 0.0000, 0.0000, 1.0000, 0.3212, 0.3212, 0.2907, 0.3212, 0.3212],
        'DelayMatchSampleDistractor1D': [0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 1.0000, 1.0000, 1.0000, 1.0000, 0.4991],
        'DelayPairedAssociation':       [0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 1.0000, 0.4866, 0.4922, 0.4917],
        'DualDelayMatchSample':         [0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 1.0000, 0.3004, 0.3004],
        'EconomicDecisionMaking':       [0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 1.0000, 0.4998],
        'GoNogo':                       [0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 1.0000]
    }
    # 绘制loss曲线
    visualize_loss(simple_task2losses, 'Without Continual Learning')
    visualize_loss(SWIL_task2losses, 'With Continual Learning (SWIL)')
    
    # 绘制F1矩阵
    visualize_f1_matrix(simple_task2f1, 'Without Continual Learning')
    visualize_f1_matrix(SWIL_task2f1, 'With Continual Learning (SWIL)')
    
    # 绘制F1折线图
    visualize_f1_line(simple_task2f1, 'Without Continual Learning')
    visualize_f1_line(SWIL_task2f1, 'With Continual Learning (SWIL)')
